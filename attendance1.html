<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employee Attendance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h2>Employee Attendance</h2>

  <select id="employeeName">
    <option value="">Select Employee</option>
    <option>Anil</option>
    <option>Anil Beniwal</option>
    <option>Ashok</option>
    <option>Geeta</option>
    <option>Imran</option>
    <option>Pandeyji</option>
    <option>Payal</option>
    <option>Sanjay</option>
    <option>Swapnil</option>
    <option>Swati</option>
  </select><br><br>

  <select id="checkType">
    <option value="">Select Check Type</option>
    <option>Check in</option>
    <option>Check out</option>
  </select><br><br>

  <button onclick="submitAttendance()">Submit Attendance</button>

  <script>
    const API_KEY = 'AIzaSyCGZzKjYXB1Egttf07R3VCZotCEPFONXOA';

    function submitAttendance() {
      const empName = document.getElementById('employeeName').value;
      const checkType = document.getElementById('checkType').value;

      if (!empName || !checkType) {
        alert('‚ö†Ô∏è Please select employee and check type');
        return;
      }

      if (navigator.geolocation) {
        alert("üìç Getting location...");

        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            alert(`üìå Your coordinates: ${lat}, ${lng}`);

            // Reverse geocode
            fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=${API_KEY}`)
              .then(response => response.json())
              .then(data => {
                const address = data.results[0]?.formatted_address || 'Unknown Address';
                alert(`üì¨ Address: ${address}`);

                // Open Google Form
                const formURL = 'https://docs.google.com/forms/d/e/1FAIpQLScVM2xlUd7Q6MulCSAE1LKXshnQtDmGym9sBYl_Y0RLMUryaw/viewform';
                const params = new URLSearchParams({
                  'entry.6835351': empName,
                  'entry.2137196455': checkType,
                  'entry.224433312': address,
                  'entry.1845950175': `${lat},${lng}`
                });

                window.open(`${formURL}?${params.toString()}`, '_blank');
              })
              .catch(() => alert('‚ùå Failed to fetch address.'));
          },
          (error) => {
            alert(`‚ùå Geolocation Error: ${error.message}`);
          }
        );
      } else {
        alert("‚ùå Geolocation not supported on this device");
      }
    }
  </script>
</body>
</html>
